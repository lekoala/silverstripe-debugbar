if(void 0===PhpDebugBar){var PhpDebugBar={};PhpDebugBar.$=jQuery}!function(t){"undefined"==typeof localStorage&&(localStorage={setItem:function(t,e){},getItem:function(t){return null}}),void 0===PhpDebugBar.utils&&(PhpDebugBar.utils={});var e=PhpDebugBar.utils.getDictValue=function(t,e,i){for(var a=t,s=e.split("."),n=0;n<s.length;n++){if(!a[s[n]])return i;a=a[s[n]]}return a},i=PhpDebugBar.utils.getObjectSize=function(t){if(Object.keys)return Object.keys(t).length;var e=0;for(var i in t)t.hasOwnProperty(i)&&e++;return e};PhpDebugBar.utils.csscls=function(t,e){if(t.indexOf(" ")>-1){for(var i=t.split(" "),a=[],s=0,n=i.length;s<n;s++)a.push(PhpDebugBar.utils.csscls(i[s],e));return a.join(" ")}return 0===t.indexOf(".")?"."+e+t.substr(1):e+t},PhpDebugBar.utils.makecsscls=function(t){return function(e){return PhpDebugBar.utils.csscls(e,t)}};var a=PhpDebugBar.utils.makecsscls("phpdebugbar-"),s=PhpDebugBar.Widget=function(e){this._attributes=t.extend({},this.defaults),this._boundAttributes={},this.$el=t("<"+this.tagName+" />"),this.className&&this.$el.addClass(this.className),this.initialize.apply(this,[e||{}]),this.render.apply(this)};t.extend(s.prototype,{tagName:"div",className:null,defaults:{},initialize:function(t){this.set(t)},render:function(){},set:function(t,e){if("string"==typeof t){if(this._attributes[t]=e,void 0!==this._boundAttributes[t])for(var i=0,a=this._boundAttributes[t].length;i<a;i++)this._boundAttributes[t][i].apply(this,[e])}else for(var s in t)this.set(s,t[s])},has:function(t){return void 0!==this._attributes[t]&&null!==this._attributes[t]},get:function(t){return this._attributes[t]},bindAttr:function(e,i){if(t.isArray(e))for(var a=0,s=e.length;a<s;a++)this.bindAttr(e[a],i);else{if(void 0===this._boundAttributes[e]&&(this._boundAttributes[e]=[]),"object"==typeof i){var n=i;i=function(t){n.text(t||"")}}this._boundAttributes[e].push(i),this.has(e)&&i.apply(this,[this._attributes[e]])}}}),s.extend=function(e){var i=this,a=function(){return i.apply(this,arguments)};t.extend(a,i);var s=function(){this.constructor=a};return s.prototype=i.prototype,a.prototype=new s,t.extend(a.prototype,e),a.__super__=i.prototype,a};var n=s.extend({className:a("panel"),render:function(){this.$tab=t("<a />").addClass(a("tab")),this.$icon=t("<i />").appendTo(this.$tab),this.bindAttr("icon",function(t){t?this.$icon.attr("class","phpdebugbar-fa phpdebugbar-fa-"+t):this.$icon.attr("class","")}),this.bindAttr("title",t("<span />").addClass(a("text")).appendTo(this.$tab)),this.$badge=t("<span />").addClass(a("badge")).appendTo(this.$tab),this.bindAttr("badge",function(t){null!==t?(this.$badge.text(t),this.$badge.show()):this.$badge.hide()}),this.bindAttr("widget",function(t){this.$el.empty().append(t.$el)}),this.bindAttr("data",function(t){this.has("widget")&&this.get("widget").set("data",t)})}}),r=s.extend({tagName:"span",className:a("indicator"),render:function(){this.$icon=t("<i />").appendTo(this.$el),this.bindAttr("icon",function(t){t?this.$icon.attr("class","phpdebugbar-fa phpdebugbar-fa-"+t):this.$icon.attr("class","")}),this.bindAttr(["title","data"],t("<span />").addClass(a("text")).appendTo(this.$el)),this.$tooltip=t("<span />").addClass(a("tooltip disabled")).appendTo(this.$el),this.bindAttr("tooltip",function(t){t?this.$tooltip.text(t).removeClass(a("disabled")):this.$tooltip.addClass(a("disabled"))})}}),o=PhpDebugBar.DatasetTitleFormater=function(t){this.debugbar=t};t.extend(o.prototype,{format:function(t,e,a){a=a?" "+a:"";var s=i(this.debugbar.datasets)+1;return void 0===e.__meta?"#"+s+a:"#"+s+" "+e.__meta.uri.substr(e.__meta.uri.lastIndexOf("/")+1)+a+" ("+e.__meta.datetime.split(" ")[1]+")"}});var h=PhpDebugBar.DebugBar=s.extend({className:"phpdebugbar "+a("minimized"),options:{bodyMarginBottom:!0,bodyMarginBottomHeight:parseInt(t("body").css("margin-bottom"))},initialize:function(){this.controls={},this.dataMap={},this.datasets={},this.firstTabName=null,this.activePanelName=null,this.datesetTitleFormater=new o(this),this.registerResizeHandler()},registerResizeHandler:function(){if(void 0!==this.resize.bind){var e=this.resize.bind(this);this.respCSSSize=0,t(window).resize(e),setTimeout(e,20)}},resize:function(){var e=this.respCSSSize;0==this.respCSSSize&&this.$header.find("> div > *:visible").each(function(){e+=t(this).outerWidth()});var i=this.$header.width(),a="phpdebugbar-mini-design",s=this.$header.hasClass(a);i<=e&&!s?(this.respCSSSize=e,this.$header.addClass(a)):e<i&&s&&(this.respCSSSize=0,this.$header.removeClass(a)),this.setHeight(this.$body.height())},render:function(){var e=this;this.$el.appendTo("body"),this.$dragCapture=t("<div />").addClass(a("drag-capture")).appendTo(this.$el),this.$resizehdle=t("<div />").addClass(a("resize-handle")).appendTo(this.$el),this.$header=t("<div />").addClass(a("header")).appendTo(this.$el),this.$headerLeft=t("<div />").addClass(a("header-left")).appendTo(this.$header),this.$headerRight=t("<div />").addClass(a("header-right")).appendTo(this.$header);var i=this.$body=t("<div />").addClass(a("body")).appendTo(this.$el);this.recomputeBottomOffset();var s,n;this.$resizehdle.on("mousedown",function(t){n=i.height(),s=t.pageY,i.parents().on("mousemove",r).on("mouseup",o),e.$dragCapture.show(),t.preventDefault()});var r=function(t){var i=n+(s-t.pageY);e.setHeight(i)},o=function(){i.parents().off("mousemove",r).off("mouseup",o),e.$dragCapture.hide()};this.$closebtn=t("<a />").addClass(a("close-btn")).appendTo(this.$headerRight),this.$closebtn.click(function(){e.close()}),this.$minimizebtn=t("<a />").addClass(a("minimize-btn")).appendTo(this.$headerRight),this.$minimizebtn.click(function(){e.minimize()}),this.$maximizebtn=t("<a />").addClass(a("maximize-btn")).appendTo(this.$headerRight),this.$maximizebtn.click(function(){e.restore()}),this.$restorebtn=t("<a />").addClass(a("restore-btn")).hide().appendTo(this.$el),this.$restorebtn.click(function(){e.restore()}),this.$openbtn=t("<a />").addClass(a("open-btn")).appendTo(this.$headerRight).hide(),this.$openbtn.click(function(){e.openHandler.show(function(t,i){e.addDataSet(i,t,"(opened)"),e.showTab()})}),this.$datasets=t("<select />").addClass(a("datasets-switcher")).appendTo(this.$headerRight),this.$datasets.change(function(){e.dataChangeHandler(e.datasets[this.value]),e.showTab()})},setHeight:function(e){var i=t(window).innerHeight()-this.$header.height()-10;e=Math.min(e,i),e=Math.max(e,40),this.$body.css("height",e),localStorage.setItem("phpdebugbar-height",e),this.recomputeBottomOffset()},restoreState:function(){var t=localStorage.getItem("phpdebugbar-height");this.setHeight(t||this.$body.height());var e=localStorage.getItem("phpdebugbar-open");if(e&&"0"==e)this.close();else{var i=localStorage.getItem("phpdebugbar-visible");if(i&&"1"==i){var a=localStorage.getItem("phpdebugbar-tab");this.isTab(a)&&this.showTab(a)}}},createTab:function(t,e,i){var a=new n({title:i||t.replace(/[_\-]/g," ").charAt(0).toUpperCase()+t.slice(1),widget:e});return this.addTab(t,a)},addTab:function(t,e){if(this.isControl(t))throw new Error(t+" already exists");var i=this;return e.$tab.appendTo(this.$headerLeft).click(function(){i.isMinimized()||i.activePanelName!=t?i.showTab(t):i.minimize()}),e.$el.appendTo(this.$body),this.controls[t]=e,null==this.firstTabName&&(this.firstTabName=t),e},createIndicator:function(t,e,i,a){var s=new r({icon:e,tooltip:i});return this.addIndicator(t,s,a)},addIndicator:function(t,e,i){if(this.isControl(t))throw new Error(t+" already exists");return"left"==i?e.$el.insertBefore(this.$headerLeft.children().first()):e.$el.appendTo(this.$headerRight),this.controls[t]=e,e},getControl:function(t){if(this.isControl(t))return this.controls[t]},isControl:function(t){return void 0!==this.controls[t]},isTab:function(t){return this.isControl(t)&&this.controls[t]instanceof n},isIndicator:function(t){return this.isControl(t)&&this.controls[t]instanceof r},reset:function(){this.minimize();var e=this;t.each(this.controls,function(t,i){e.isTab(t)&&i.$tab.remove(),i.$el.remove()}),this.controls={}},showTab:function(e){if(e||(e=this.activePanelName?this.activePanelName:this.firstTabName),!this.isTab(e))throw new Error("Unknown tab '"+e+"'");this.$resizehdle.show(),this.$body.show(),this.recomputeBottomOffset(),t(this.$header).find("> div > ."+a("active")).removeClass(a("active")),t(this.$body).find("> ."+a("active")).removeClass(a("active")),this.controls[e].$tab.addClass(a("active")),this.controls[e].$el.addClass(a("active")),this.activePanelName=e,this.$el.removeClass(a("minimized")),localStorage.setItem("phpdebugbar-visible","1"),localStorage.setItem("phpdebugbar-tab",e),this.resize()},minimize:function(){this.$header.find("> div > ."+a("active")).removeClass(a("active")),this.$body.hide(),this.$resizehdle.hide(),this.recomputeBottomOffset(),localStorage.setItem("phpdebugbar-visible","0"),this.$el.addClass(a("minimized")),this.resize()},isMinimized:function(){return this.$el.hasClass(a("minimized"))},close:function(){this.$resizehdle.hide(),this.$header.hide(),this.$body.hide(),this.$restorebtn.show(),localStorage.setItem("phpdebugbar-open","0"),this.$el.addClass(a("closed")),this.recomputeBottomOffset()},isClosed:function(){return this.$el.hasClass(a("closed"))},restore:function(){this.$resizehdle.show(),this.$header.show(),this.$restorebtn.hide(),localStorage.setItem("phpdebugbar-open","1");var t=localStorage.getItem("phpdebugbar-tab");this.isTab(t)&&this.showTab(t),this.$el.removeClass(a("closed")),this.resize()},recomputeBottomOffset:function(){if(this.options.bodyMarginBottom){if(this.isClosed())return t("body").css("margin-bottom",this.options.bodyMarginBottomHeight||"");var e=parseInt(this.$el.height())+this.options.bodyMarginBottomHeight;t("body").css("margin-bottom",e)}},setDataMap:function(t){this.dataMap=t},addDataMap:function(e){t.extend(this.dataMap,e)},setData:function(t){return this.datasets={},this.addDataSet(t)},addDataSet:function(e,a,s){var n=this.datesetTitleFormater.format(a,e,s);return a=a||i(this.datasets)+1,this.datasets[a]=e,this.$datasets.append(t('<option value="'+a+'">'+n+"</option>")),this.$datasets.children().length>1&&this.$datasets.show(),this.showDataSet(a),a},loadDataSet:function(t,e,i){if(!this.openHandler)throw new Error("loadDataSet() needs an open handler");var a=this;this.openHandler.load(t,function(s){a.addDataSet(s,t,e),i&&i(s)})},getDataSet:function(t){return this.datasets[t]},showDataSet:function(t){this.dataChangeHandler(this.datasets[t]),this.$datasets.val(t)},dataChangeHandler:function(i){var a=this;t.each(this.dataMap,function(t,s){var n=e(i,s[0],s[1]);-1!=t.indexOf(":")?(t=t.split(":"),a.getControl(t[0]).set(t[1],n)):a.getControl(t).set("data",n)})},setOpenHandler:function(t){this.openHandler=t,null!==t?this.$openbtn.show():this.$openbtn.hide()},getOpenHandler:function(){return this.openHandler}});h.Tab=n,h.Indicator=r;var d=PhpDebugBar.AjaxHandler=function(t,e){this.debugbar=t,this.headerName=e||"phpdebugbar"};t.extend(d.prototype,{handle:function(t){return!!this.loadFromId(t)||this.loadFromData(t)},loadFromId:function(t){var e=this.extractIdFromHeaders(t);return!(!e||!this.debugbar.openHandler)&&(this.debugbar.loadDataSet(e,"(ajax)"),!0)},extractIdFromHeaders:function(t){return t.getResponseHeader(this.headerName+"-id")},loadFromData:function(t){var e=this.extractDataFromHeaders(t);if(!e)return!1;var i=this.parseHeaders(e);if(i.error)throw new Error("Error loading debugbar data: "+i.error);return i.data&&this.debugbar.addDataSet(i.data,i.id,"(ajax)"),!0},extractDataFromHeaders:function(t){var e=t.getResponseHeader(this.headerName);if(e){for(var i=1;;i++){var a=t.getResponseHeader(this.headerName+"-"+i);if(!a)break;e+=a}return decodeURIComponent(e)}},parseHeaders:function(t){return JSON.parse(t)},bindToJquery:function(t){var e=this;t(document).ajaxComplete(function(t,i,a){a.ignoreDebugBarAjaxHandler||e.handle(i)})},bindToXHR:function(){var t=this,e=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(i,a,s,n,r){var o=this;this.addEventListener("readystatechange",function(){var e=t.debugbar.openHandler?t.debugbar.openHandler.get("url"):null;4==o.readyState&&0!==a.indexOf(e)&&t.handle(o)},!1),e.apply(this,Array.prototype.slice.call(arguments))}}})}(PhpDebugBar.$);